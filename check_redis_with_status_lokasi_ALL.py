import requests
from requests.exceptions import RequestException, Timeout

ips = [
    "111.1.2.90",
    "10.2.43.175",
    "10.43.9.70",
    "10.44.3.11",
    "111.24.1.90",
    "111.3.6.36",
    "111.4.10.95",
    "111.0.153.247",
    "10.3.62.210",
    "111.2.16.32",
    "172.16.8.75",
    "10.15.119.240",
    "111.0.221.11",
    "111.10.3.41",
    "10.15.57.40",
    "111.10.6.40",
    "10.43.13.70",
    "10.15.79.40",
    "10.18.1.10",
    "10.15.31.20",
    "10.15.54.10",
    "112.0.56.100",
    "111.0.173.30",
    "10.15.42.70",
    "112.0.21.30",
    "111.10.6.46",
    "111.0.108.10",
    "112.0.26.20",
    "10.37.8.40",
    "111.8.1.96",
    "112.0.28.250",
    "111.4.2.21",
    "111.0.25.30",
    "172.16.13.130",
    "10.15.131.155",
    "10.15.138.55",
    "111.0.114.6",
    "10.42.9.110",
    "111.0.30.120",
    "111.0.135.44",
    "172.16.7.191",
    "111.0.63.20",
    "112.5.5.40",
    "112.5.1.40",
    "111.10.1.40",
    "111.4.13.225",
     "10.15.42.70",
    "10.18.96.160",
    "10.10.43.11",
    "111.0.221.11",
    "10.15.127.32",
    "10.18.110.20",
    "10.18.113.50",
    "111.0.168.30",
    "192.168.228.20",
    "111.0.150.237",
    "111.0.150.20",
    "10.15.87.54",
    "192.168.167.70",
    "111.0.63.20",
    "10.15.94.54",
    "10.15.72.140",
    "10.15.117.40",
    "192.168.4.101",
    "112.0.28.250",
    "10.15.79.41",
    "111.0.202.95",
    "111.0.35.40",
    "10.15.56.56",
    "10.18.1.10",
    "111.16.10.252",
    "112.0.1.110",
    "111.0.92.110",
    "111.0.92.30",
    "192.168.10.20",
"192.168.228.20",
"192.168.167.70",
"10.10.10.35",
"192.168.144.102",
"10.15.40.53",
"111.0.29.100",
"10.15.25.10",
"10.15.53.54",
"10.15.122.12",
"112.0.20.53",
"111.0.203.215",
"10.37.4.40",
"111.8.8.10",
"10.15.110.40",
"112.0.2.53",
"10.15.82.20",
"10.15.118.26",
"111.0.201.171",
"111.0.230.30",
"10.18.96.160",
"10.16.61.130",
"111.16.16.20",
"111.0.150.237",
"111.4.11.30",
"111.0.150.20",
"10.15.118.26",
"111.0.201.171",
"112.0.20.53",
"10.15.122.12",
"10.15.140.221",
"10.15.87.54",
"112.0.38.20",
"10.12.13.41"
"111.0.201.171",
"10.16.61.130",
"10.18.96.160",
"111.0.230.32",
"10.15.118.26"
]
TIMEOUT = 5  # detik
warning_gates = []

print("\nüîç Checking Redis Brooo (list_zero)\n")

for ip in ips:
    url = f"http://{ip}:3006/redis-parkee-listener"

    try:
        r = requests.get(url, timeout=TIMEOUT)
        r.raise_for_status()

        data = r.json()
        list_zero = data.get("list_zero", [])

        if list_zero:
            print(f"‚ö†Ô∏è  WARNING | {ip}")
            print(f"    Zero Status : {', '.join(list_zero)}")
            print(f"    Location    : {data.get('location')}")

            warning_gates.append({
                "ip": ip,
                "list_zero": list_zero,
                "location": data.get("location")
            })
        else:
            print(f"‚úÖ OK      | {ip}")

    except Timeout:
        print(f"üî• TIMEOUT | {ip}")
    except ValueError:
        print(f"‚ùå INVALID JSON | {ip}")
    except RequestException as e:
        print(f"üíÄ DOWN   | {ip} | {e.__class__.__name__}")

# ===== SUMMARY =====
print("\nüìå SUMMARY GATE WARNING\n")

if not warning_gates:
    print("üéâ Tidak ada gate dengan status WARNING")
else:
    for idx, gate in enumerate(warning_gates, 1):
        print(f"{idx}. {gate['ip']}")
        print(f"   Location    : {gate['location']}")
        print(f"   Zero Status : {', '.join(gate['list_zero'])}")
        
print(f"\nTotal Gates with WARNING: {len(warning_gates)}\n")

print("‚úÖ Check Redis Brooo Selesai\n")
